on: [push]
name: Test
jobs:
  # use no configuration. Will update existing pull request:
  # https://github.com/gr2m/create-or-update-pull-request-action/pull/2
  happyPath:
    name: Update existing pull request
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - run: "date > test.txt"
      - run: "npm ci"
      - run: "npm run build"
      - uses: ./
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          ACTIONS_STEP_DEBUG: true

  createNewPullRequest:
    name: Create new pull request
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - run: "date > test.txt"
      - run: "npm ci"
      - run: "npm run build"
      - uses: ./
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          ACTIONS_STEP_DEBUG: true
        with:
          title: Test pull request
          body: This pull request is part of the CI  - please ignore.
          branch: test-create-new-pull-request
          commit-message: "Just testing [skip ci]"
          author: "J. Doe <j@example.com>"
      - run: "git push https://x-access-token:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git :existing-branch"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  multipleCommits:
    name: Create new pull request
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
      - run: "date > file1.txt"
      - run: "date > file2.txt"
      - run: "npm ci"
      - run: "npm run build"
      - uses: ./
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          ACTIONS_STEP_DEBUG: true
        with:
          title: Test pull request
          body: This pull request is part of the CI  - please ignore.
          branch: test-create-new-pull-request-with-multiple-commits
          author: "J. Doe <j@example.com>"
          commits:
            - path: file1.txt
              message: "file 1 created"
            - path: file2.txt
              message: "file 2 created"
            - path: does-not-exist.txt
              message: "Action should not fail when path does not match any uncommitted files"
      - run: "git push https://x-access-token:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git :existing-branch"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
